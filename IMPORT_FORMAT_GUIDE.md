# 导入模板格式说明

## 📊 新格式（横向布局）

### 检测数据表格格式

```
检测项目 \ 样品编号 | S20250115001 | S20250115002 | S20250115003 |
--------------------+--------------+--------------+--------------+
pH                  | 7.2          | 7.3          | 7.1          |
浊度                | 0.5          | 0.6          | 0.4          |
余氯                | 0.3          | 0.35         | 0.28         |
色度                | <5           | <5           | <5           |
臭和味              | 无           | 无           | 无           |
肉眼可见物          | 无           | 无           | 无           |
耗氧量              | 1.2          | 1.3          | 1.1          |
总大肠菌群          | 未检出       | 未检出       | 未检出       |
菌落总数            | <1           | <1           | <1           |
```

### 优点 ✅

1. **横向对比清晰**
   - 同一指标的多个样品数值在同一行，便于对比分析
   - 符合实验室人员的阅读习惯

2. **填写效率高**
   - 批量填写同一指标时，可以在同一行操作
   - 减少上下滚动，提高填写效率

3. **数据查看方便**
   - Excel冻结首行首列功能完美适用
   - 大量数据时依然能清晰看到表头

4. **适合打印**
   - 横向布局更适合A4纸横向打印
   - 数据密度合理，不浪费空间

### 使用场景

- ✅ 多个样品同时检测同一批指标
- ✅ 需要横向对比分析数据
- ✅ 实验室日常批量数据录入
- ✅ 检测项目固定，样品数量变化

---

## 📋 旧格式（纵向布局）

### 检测数据表格格式

```
样品编号       | 指标名称     | 检测值   | 备注
--------------+-------------+---------+------
S20250115001  | pH          | 7.2     |
S20250115001  | 浊度        | 0.5     |
S20250115001  | 余氯        | 0.3     |
S20250115002  | pH          | 7.3     |
S20250115002  | 浊度        | 0.6     |
S20250115002  | 余氯        | 0.35    |
S20250115003  | pH          | 7.1     |
S20250115003  | 浊度        | 0.4     |
S20250115003  | 余氯        | 0.28    |
```

### 缺点 ❌

1. **数据分散**
   - 同一指标的数据分散在不同行
   - 难以快速对比

2. **填写繁琐**
   - 每行都要填写样品编号
   - 重复操作多

3. **行数过多**
   - N个样品 × M个指标 = N×M行
   - 大量数据时难以浏览

---

## 🔄 格式转换示例

### 示例数据

**3个样品，3个指标**

#### 新格式（9个单元格）
```
         | S001 | S002 | S003 |
---------+------+------+------+
pH       | 7.2  | 7.3  | 7.1  |
浊度     | 0.5  | 0.6  | 0.4  |
余氯     | 0.3  | 0.35 | 0.28 |
```

#### 旧格式（9行 × 3列 = 27个单元格）
```
S001 | pH   | 7.2
S001 | 浊度 | 0.5
S001 | 余氯 | 0.3
S002 | pH   | 7.3
S002 | 浊度 | 0.6
S002 | 余氯 | 0.35
S003 | pH   | 7.1
S003 | 浊度 | 0.4
S003 | 余氯 | 0.28
```

**数据量对比：新格式节省 67% 的单元格！**

---

## 📝 填写指南

### 1. 下载模板

在"报告填写"页面：
1. 选择报告模板
2. 点击"下载导入模板"按钮
3. 获得包含3个sheet的Excel文件

### 2. 填写基本信息

在"基本信息"sheet中：
- 每行一个样品的基本信息
- 样品编号建议格式：`S+日期+序号`（如 S20250115001）
- 样品类型必须是系统中已存在的类型

### 3. 填写检测数据（新格式）

在"检测数据"sheet中：

**步骤1：填写样品编号**
- 在第1行（B1, C1, D1...）填写样品编号
- 与基本信息中的样品编号保持一致

**步骤2：填写检测值**
- 在交叉单元格中填写对应的检测值
- 例如：pH项目、S001样品的值 → 单元格B2

**步骤3：扩展列（可选）**
- 如果样品较多，继续向右扩展列
- 系统会自动读取到最后一个有数据的列

### 4. 上传导入

1. 点击"批量导入"按钮
2. 选择填写好的Excel文件
3. 系统自动解析并创建报告
4. 查看导入结果（成功/失败/警告）

---

## ⚠️ 注意事项

### 必填项
- 样品编号（不能为空）
- 样品类型（必须存在于系统中）
- 检测项目名称（必须存在于系统中）
- 检测值（至少要有一个项目有值）

### 数据规范
1. **样品编号规范**
   - 建议：S+日期+序号（如 S20250115001）
   - 唯一性：同一次导入中不能重复
   - 一致性：基本信息和检测数据中必须一致

2. **日期格式**
   - 统一使用：YYYY-MM-DD
   - 例如：2025-01-15

3. **检测值格式**
   - 数值：直接填写数字（7.2, 0.5）
   - 未检出：填写"未检出"
   - 小于检出限：填写"<1"或"<5"

### 常见问题

**Q1：样品编号填错了怎么办？**
A：导入会失败，修改后重新导入即可，不会重复创建。

**Q2：检测项目名称不匹配？**
A：先在"检测指标管理"中创建该指标，然后再导入。

**Q3：能导入多少个样品？**
A：理论上无限制，建议单次不超过50个样品，以保证导入速度。

**Q4：可以只填部分检测项目吗？**
A：可以，空白的单元格会被忽略，不会创建数据。

---

## 🔧 技术实现

### 模板生成
- 文件：`import_template_generator.py`
- 方法：`_create_detection_data_sheet()`
- 特点：自动添加表头、示例数据、冻结窗格

### 数据解析
- 文件：`import_processor.py`
- 方法：`_parse_detection_data()`
- 逻辑：
  1. 读取首行样品编号（B1开始）
  2. 读取首列检测项目（A2开始）
  3. 遍历数据区域，建立样品-项目-值的映射

### API接口
- 下载模板：`GET /api/download-import-template?template_id={id}`
- 批量导入：`POST /api/import-reports`

---

## 📅 更新日志

### 2026-01-27
- ✅ 重构导入模板为横向格式
- ✅ 更新解析逻辑支持横向数据
- ✅ 优化填写说明
- ✅ 提交到GitHub (commit 7141fa4)

---

**提示**：如需恢复旧格式，请查看 Git 历史提交记录 `a6e28e8`
