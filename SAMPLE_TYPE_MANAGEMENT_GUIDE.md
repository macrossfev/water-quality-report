# 样品类型管理使用指南

## 📋 功能概述

样品类型管理模块用于创建和管理水质检测的样品类型，并为每个样品类型配置相应的检测项目。

---

## 🎯 正确的使用逻辑

### 主页面功能
- **只有一个按钮**："添加样品类型"
- 用于创建新的样品类型

### 每个样品类型的操作
每个已创建的样品类型都有4个独立的操作按钮：

1. **编辑** - 修改样品类型信息和检测项目（通过勾选）
2. **导出** - 导出该样品类型的检测项目到Excel
3. **导入** - 从Excel导入检测项目到该样品类型
4. **删除** - 删除该样品类型

---

## ✅ 添加样品类型

### 步骤：
1. 点击"添加样品类型"按钮
2. 填写基本信息：
   - **样品名称**（必填）：如"出厂水"
   - **样品代码**（必填）：如"CCW"
   - **说明**（可选）
   - **备注**（可选）
3. 在右侧勾选检测项目：
   - 检测项目按分组显示
   - 显示项目名称、单位和备注信息
   - 可使用"全选"/"取消全选"快速操作
4. 点击"保存"

### 勾选界面说明：
```
✓ pH (/)
  ℹ 用于测量水的酸碱度

✓ 浑浊度 (NTU)
  ℹ 测量水的清澈程度

□ 色度 (度)
  ℹ 测量水的颜色深浅
```

---

## ✏️ 编辑样品类型

### 两种编辑方式：

#### 方式1：手动勾选（推荐）
1. 点击样品类型的"编辑"按钮
2. 修改样品信息或检测项目勾选
3. 点击"保存"

**优点**：
- 直观清晰
- 看到所有可选项目和备注
- 不易出错

#### 方式2：Excel导入（批量调整）
1. 先点击"导出"按钮，下载当前的检测项目
2. 在Excel中修改（增删项目）
3. 点击"导入"按钮，上传修改后的文件

**适用场景**：
- 需要批量调整多个检测项目
- 需要备份当前配置

---

## 📤 导出检测项目

### 功能说明：
- 导出**单个**样品类型的所有检测项目
- 用于备份或作为导入模板

### 操作步骤：
1. 找到要导出的样品类型
2. 点击"导出"按钮
3. 下载Excel文件

### Excel格式：

| 检测项目名称 | 单位 | 所属分组 | 限值 | 检测方法 | 默认值 | 备注 |
|-------------|------|----------|------|----------|--------|------|
| pH | / | 出厂水 | 不小于6.5且不大于8.5 | GB/T 5750.4-2023 8.1 | | |
| 浑浊度 | NTU | 出厂水 | 1 | GB/T 5750.4-2023 2.1 | | |
| 菌落总数 | CFU/mL | 出厂水 | 100 | GB/T 5750.12-2023 4.1 | | |

---

## 📥 导入检测项目

### ⚠️ 严格校验规则

导入时会**严格校验**以下7个字段，全部匹配才会导入：

1. 检测项目名称（必须在系统中存在）
2. 单位
3. 所属分组
4. 限值
5. 检测方法
6. 默认值
7. 备注

**任何字段不匹配，该检测项目都会被跳过！**

### 操作步骤：

#### 1. 导出现有配置作为模板
```
点击"导出"按钮 → 获取标准格式的Excel
```

#### 2. 修改Excel文件
- 参照导出的格式
- 确保所有字段与系统中的检测指标**完全一致**
- 可以增删行（检测项目）

#### 3. 导入修改后的文件
```
点击"导入"按钮 → 阅读警告 → 选择文件 → 查看结果
```

### 导入前警告：

系统会显示严格的警告提示：
```
⚠️ 导入功能严格受限 - 请谨慎使用

严格校验规则：
1. 样品类型信息：样品类型名称、样品代码、说明必须填写
2. 检测项目完整匹配：每个检测项目必须包含所有字段
3. 严格匹配：导入的检测项目信息必须与"检测指标管理"中已存在的检测项目完全一致
4. 不一致则跳过：任何字段不匹配的检测项目都会被跳过

建议：
- 如果只是少量调整，建议使用"编辑"按钮手动勾选
- 导入前先导出现有数据作为模板参考
```

### 导入结果示例：

**成功示例：**
```
样品类型"出厂水"的检测项目导入完成！

✓ 成功关联: 10 个检测项目
```

**部分成功示例：**
```
样品类型"管网水"的检测项目导入完成！

✓ 成功关联: 5 个检测项目

⚠ 以下检测项目因信息不匹配被跳过 (3个):
  - 第3行: 检测项目"浑浊度"字段不匹配 - 单位不匹配(系统:NTU vs 导入:度)
  - 第5行: 检测项目"余氯"字段不匹配 - 检测方法不匹配
  - 第7行: 检测项目"总硬度"不存在
```

---

## 🔍 为什么要严格校验？

### 确保数据质量
- 检测项目的单位、限值、检测方法等信息直接影响检测结果的准确性
- 严格校验防止因字段不一致导致的数据错误

### 强制规范化
- 所有检测项目必须在"检测指标管理"中预先定义
- 确保整个系统使用统一的检测标准

### 可追溯性
- 导入结果会详细记录哪些项目匹配，哪些被跳过
- 方便问题排查和数据审计

---

## 💡 最佳实践

### ✅ 推荐做法

1. **日常操作优先手动勾选**
   ```
   添加样品类型 → 勾选检测项目 → 保存
   ```
   - 清晰直观
   - 能看到备注信息
   - 不易出错

2. **定期导出备份**
   ```
   每个样品类型 → 导出 → 保存Excel文件
   ```
   - 保留配置历史
   - 便于恢复

3. **批量调整使用导入**
   ```
   导出 → 修改Excel → 导入
   ```
   - 适合大量修改
   - 先导出再修改更安全

### ❌ 避免做法

1. ❌ 直接手写Excel导入（容易出错）
2. ❌ 不看警告就导入
3. ❌ 忽略导入结果中的跳过项
4. ❌ 字段信息不完全一致就导入

---

## 📊 完整工作流程示例

### 场景1：创建新样品类型

```
1. 点击"添加样品类型"
2. 填写：
   - 名称：出厂水
   - 代码：CCW
   - 说明：城市供水出厂水质检测
3. 勾选检测项目：
   ✓ pH
   ✓ 浑浊度
   ✓ 色度
   ✓ 菌落总数
   ✓ 总大肠菌群
4. 保存
```

### 场景2：修改已有样品类型

```
方式A - 手动勾选：
1. 点击"编辑"
2. 调整勾选（添加或移除检测项目）
3. 保存

方式B - Excel导入：
1. 点击"导出" → 下载当前配置
2. 修改Excel（添加/删除行）
3. 点击"导入" → 上传修改后的文件
4. 查看导入结果
```

### 场景3：复制样品类型配置

```
1. 找到要复制的样品类型
2. 点击"导出" → 下载配置
3. 点击"添加样品类型"
4. 填写新的样品信息
5. 参照导出的Excel手动勾选检测项目
6. 保存
```

---

## 🚫 常见问题

### Q1: 为什么我导入的检测项目被跳过了？

**A:** 检测项目被跳过通常是因为字段不匹配。系统会告诉你具体原因：

```
第3行: 检测项目"pH"字段不匹配 - 单位不匹配(系统:/ vs 导入:无单位)
```

**解决方法：**
1. 检查"检测指标管理"中该项目的准确信息
2. 确保Excel中的所有字段与系统完全一致
3. 最安全的方式：从系统导出Excel，然后只修改需要的部分

### Q2: Excel中的空值应该如何处理？

**A:**
- 系统为空 → Excel留空
- 系统有值 → Excel必须填写完全一致的值

### Q3: 可以通过导入创建新的检测项目吗？

**A:**
不可以。导入只能关联已存在的检测项目。

如需新的检测项目：
1. 先到"检测指标管理"添加
2. 然后在样品类型中勾选或导入

### Q4: 导入会覆盖现有配置吗？

**A:**
会的。导入时会：
1. 删除该样品类型的所有现有检测项目关联
2. 根据Excel重新创建关联
3. 只关联匹配成功的项目

**建议：** 导入前先导出备份当前配置！

### Q5: 勾选界面的备注信息是什么？

**A:**
备注信息来自"检测指标管理"中的"备注"字段，用于说明该检测项目的用途、注意事项等。

```
✓ pH (/)
  ℹ 用于测量水的酸碱度，影响消毒效果
```

---

## 📝 Excel格式详细说明

### 表头（必须）

| 列号 | 列名 | 说明 | 示例 |
|------|------|------|------|
| A | 检测项目名称 | 必填，必须在系统中存在 | pH |
| B | 单位 | 必须与系统完全一致 | / |
| C | 所属分组 | 必须与系统完全一致 | 出厂水 |
| D | 限值 | 必须与系统完全一致 | 不小于6.5且不大于8.5 |
| E | 检测方法 | 必须与系统完全一致 | GB/T 5750.4-2023 8.1 |
| F | 默认值 | 必须与系统完全一致 | (空) |
| G | 备注 | 必须与系统完全一致 | (空) |

### 注意事项

1. **表头必须在第1行**
2. **数据从第2行开始**
3. **所有字段都要填写**（即使是空值）
4. **字段值必须完全匹配**（包括空格、标点符号）
5. **检测项目的顺序决定了显示顺序**

---

## 🔒 权限说明

- **添加样品类型**：需要管理员权限
- **编辑样品类型**：需要管理员权限
- **导出检测项目**：需要管理员权限
- **导入检测项目**：需要管理员权限
- **删除样品类型**：需要管理员权限

---

## 📅 版本历史

- **2026-02-01**: 重构样品类型管理逻辑
  - 移除主页面的全局导入导出
  - 为每个样品类型添加独立的导入导出功能
  - 勾选界面显示检测指标备注
  - 实现严格的字段校验

---

## 💬 技术支持

如果在使用过程中遇到问题：

1. **检查Excel格式**：确保表头和数据格式正确
2. **查看错误信息**：仔细阅读系统返回的错误和警告
3. **核对字段值**：确保与系统中的检测项目完全一致
4. **使用手动方式**：如果导入困难，建议使用编辑按钮手动勾选

---

**重要提示**：样品类型的检测项目配置直接影响后续的检测报告生成，请谨慎操作！
