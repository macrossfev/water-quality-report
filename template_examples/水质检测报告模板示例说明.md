# 水质检测报告Excel模板创建示例

本文档提供完整的Excel模板创建示例和说明。

## 模板结构

标准的水质检测报告模板应包含以下工作表：
1. 第一页 - 报告信息页（封面/基本信息）
2. 第二页 - 检测项目说明（可选）
3. 第三页 - 检测数据表（主数据页）
4. 第四页 - 检测数据表（溢出页，如果数据较多）

---

## 第一页：报告信息页

### 布局示例

```
A列                B列                     C列
─────────────────────────────────────────────────────
1   水质检测报告
2
3   报告编号：     [#report_no]
4   样品编号：     [#sample_no]
5   样品类型：     [#sample_type]
6
7   === 委托单位信息 ===
8   委托单位：     [#company]
9   被检单位：     [#customer_unit]
10  被检水厂：     [#customer_plant]
11  单位地址：     [#unit_address]
12
13  === 采样信息 ===
14  采样日期：     [#sampling_date]
15  采样人员：     [#sampler]
16  采样地点：     [#sampling_location]
17  采样依据：     [#sampling_basis]
18  样品来源：     [#sample_source]
19  样品状态：     [#sample_status]
20  收样日期：     [#sample_received]
21
22  === 检测信息 ===
23  检测日期：     [#detection_date]
24  检测人员：     [#detection_person]
25  审核人员：     [#review_person]
26  报告日期：     [#report_date]
27
28  === 其他信息 ===
29  产品标准：     [#product_standard]
30  检测结论：     [#test_conclusion]
```

---

## 第三页：检测数据表（主数据页）

### 表格布局示例

```
行  A列          B列              C列      D列          E列          F列
───────────────────────────────────────────────────────────────────────
1   水质检测数据表
2
3   样品编号：[#sample_no]          检测日期：[#detection_date]
4
5   ───────────────────────────────────────────────────────────────────
6   序号  检测项目        单位      检测结果      标准限值      检测方法
7   ───────────────────────────────────────────────────────────────────
8   [#dt_index]  [#dt_name]  [#dt_unit]  [#dt_result]  [#dt_limit]  [#dt_method]
9
10
...（数据会从第8行开始自动填充）
...
29
30  [#dt_end]                                        ← 数据区结束标记
31
32  检测人员：[#detection_person]      审核人员：[#review_person]
```

**说明**：
- 第8行：放置字段代号，系统会从这一行开始填充数据
- 第30行：放置 `[#dt_end]` 标记，表示该页最多填充22行数据（第8-29行）
- 如果检测项目超过22个，会自动溢出到第四页

---

## 第四页：检测数据表（溢出页）

### 结构与第三页完全相同

```
行  A列          B列              C列      D列          E列          F列
───────────────────────────────────────────────────────────────────────
1   水质检测数据表（续）
2
3   样品编号：[#sample_no]          检测日期：[#detection_date]
4
5   ───────────────────────────────────────────────────────────────────
6   序号  检测项目        单位      检测结果      标准限值      检测方法
7   ───────────────────────────────────────────────────────────────────
8   [#dt_index]  [#dt_name]  [#dt_unit]  [#dt_result]  [#dt_limit]  [#dt_method]
9
10
...（数据从第8行开始继续填充）
...
29
30  [#dt_end]                                        ← 数据区结束标记
31
32  检测人员：[#detection_person]      审核人员：[#review_person]
```

**填充规则**：
- 如果第三页有22个检测项目（填满），第23个项目会自动填充到第四页第8行
- 序号会连续：第三页是1-22，第四页是23-44

---

## 字段代号完整列表

### 报告基本信息字段（推荐使用）

| 代号 | 说明 | 示例值 |
|------|------|--------|
| `[#report_no]` | 报告编号 | 20260202编2 |
| `[#sample_no]` | 样品编号 | S20260202001 |
| `[#sample_type]` | 样品类型 | 出厂水 |
| `[#company]` | 委托单位 | XX自来水公司 |
| `[#customer_unit]` | 被检单位 | XX水厂 |
| `[#customer_plant]` | 被检水厂 | 朱家岩水厂 |
| `[#unit_address]` | 单位地址 | XX市XX区XX路XX号 |
| `[#sampling_date]` | 采样日期 | 2026年2月2日 |
| `[#sampler]` | 采样人 | 张三 |
| `[#sampling_location]` | 采样地点 | 水厂出水口 |
| `[#sampling_basis]` | 采样依据 | GB/T 5750-2006 |
| `[#sample_source]` | 样品来源 | 水厂送检 |
| `[#sample_status]` | 样品状态 | 完好 |
| `[#sample_received]` | 收样日期 | 2026年2月2日 |
| `[#detection_date]` | 检测日期 | 2026年2月3日 |
| `[#detection_person]` | 检测人 | 李四 |
| `[#review_person]` | 审核人 | 王五 |
| `[#report_date]` | 报告编制日期 | 2026年2月5日 |
| `[#product_standard]` | 产品标准 | GB 5749-2022 |
| `[#test_conclusion]` | 检测结论 | 合格 |

### 检测数据列代号

| 代号 | 说明 | 备注 |
|------|------|------|
| `[#dt_index]` | 序号 | 自动编号1,2,3... |
| `[#dt_name]` | 检测项目 | pH、菌落总数等 |
| `[#dt_unit]` | 单位 | 无量纲、CFU/mL等 |
| `[#dt_result]` | 检测结果 | 7.2、<1等 |
| `[#dt_limit]` | 标准限值 | 6.5-8.5、≤100等 |
| `[#dt_method]` | 检测方法 | GB 5750.4-2006等（见下方说明）|
| `[#dt_judgment]` | 单项判定 | 合格/不合格（可选）|

#### 检测方法字段格式说明

检测方法字段 `[#dt_method]` 支持灵活的分行显示方式：

**方式一：手动换行（推荐）**
- 在指标管理的"检测方法"字段中，可以直接输入换行符来控制分行
- 输入方法：在文本框中按 Enter 键，或输入 `\n` 作为换行符
- 示例：
  ```
  GB/T 5750.5-2023 4.2
  离子色谱法
  ```

**方式二：自动换行**
- 如果检测方法文本中不包含换行符，系统会自动在标准编号后添加换行
- 识别格式：`标准编号 + 空格 + 方法名称`
  - 标准编号：GB/T、GB、HJ、CJ 开头，后跟数字、横杠、版本号
  - 可选：标准编号后可跟章节号（如 4.2）
- 示例输入：
  - `GB/T 5750.5-2023 4.2 离子色谱法`
- 自动转换为：
  ```
  GB/T 5750.5-2023 4.2
  离子色谱法
  ```

**格式建议**：
- 优先使用手动换行，更精确可控
- 对于非标准格式的检测方法，使用手动换行
- 标准格式可依赖自动换行，但手动换行仍然优先

### 控制标记

| 代号 | 说明 | 使用位置 |
|------|------|----------|
| `[#dt_end]` | 数据区结束标记 | 数据表最后一行 |

### 引用字段（可选，用于自动引用历史数据）

| 格式 | 说明 | 示例 |
|------|------|------|
| `[*字段名]` | 从已审核报告引用 | `[*被检单位]`, `[*采样人]` |

**何时使用引用字段**：
- 重复客户：使用 `[*被检单位]` 自动填充历史客户信息
- 固定人员：使用 `[*采样人]`、`[*检测人]` 自动填充常用人员

---

## 实际案例：报告编号20260202编2

假设该报告包含2个检测项目：pH 和 菌落总数

### 填充效果

**第一页（报告信息）**：
```
报告编号：20260202编2
样品编号：S20260202001
样品类型：出厂水

委托单位：XX自来水公司
被检单位：XX水厂
被检水厂：朱家岩水厂
...
检测日期：2026年2月3日
检测人员：李四
```

**第三页（检测数据）**：
```
序号  检测项目      单位          检测结果    标准限值      检测方法
1     pH           无量纲         7.2        6.5-8.5      GB 5750.4-2006
2     菌落总数      CFU/mL        <1         ≤100         GB 5750.12-2006
```

如果有更多检测项目（如30个），前22个会填充在第三页，第23-30个会自动填充到第四页。

---

## 创建步骤

1. **打开Excel，创建工作簿**
2. **创建工作表**：重命名为 Sheet1, Sheet2, Sheet3, Sheet4
3. **在各工作表中填入字段代号**：参考上述布局
4. **设置格式**：
   - 添加边框、背景色
   - 调整列宽、行高
   - 合并单元格（标题等）
5. **保存文件**：保存为 .xlsx 格式
6. **上传到系统**：在报告模板管理页面导入

---

## 注意事项

1. **字段代号必须完全匹配**：包括方括号和#号，如 `[#report_no]`
2. **检测数据列必须在同一行**：所有列代号（index、name、unit等）应在同一行
3. **数据区结束标记必须设置**：否则默认容量为1000行（可能导致页面布局混乱）
4. **工作表名称可以自定义**：系统按字母顺序排序工作表进行跨页填充
5. **可以使用Excel公式**：其他单元格可以正常使用Excel公式，不会被覆盖

---

## 测试模板

上传模板后，系统会显示识别到的字段：
- 基本信息字段：X 个
- 检测数据列：X 个
- 控制标记：X 个
- 数据页容量：Sheet1(22行), Sheet2(22行)

如果识别结果正确，就可以用该模板生成报告了！
