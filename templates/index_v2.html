<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>水质检测报告系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar navbar-dark bg-primary">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">
                <i class="bi bi-droplet-fill"></i> 水质检测报告系统
            </span>
            <div class="d-flex align-items-center text-white">
                <span class="me-3">
                    <i class="bi bi-person-circle"></i>
                    <span id="currentUsername">用户</span>
                    <span class="badge bg-light text-dark ms-2" id="currentUserRole">角色</span>
                </span>
                <button class="btn btn-outline-light btn-sm" id="logoutBtn">
                    <i class="bi bi-box-arrow-right"></i> 退出
                </button>
            </div>
        </div>
    </nav>

    <!-- 主内容区 -->
    <div class="container-fluid mt-3">
        <!-- 标签页导航 -->
        <ul class="nav nav-tabs" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation" id="templateTabLi">
                <button class="nav-link active" id="template-tab" data-bs-toggle="tab" data-bs-target="#template" type="button">
                    <i class="bi bi-file-earmark-text"></i> 模板管理
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="report-tab" data-bs-toggle="tab" data-bs-target="#report" type="button">
                    <i class="bi bi-clipboard-data"></i> 报告填写
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="review-tab" data-bs-toggle="tab" data-bs-target="#review" type="button">
                    <i class="bi bi-clipboard-check"></i> 报告审核
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="generate-tab" data-bs-toggle="tab" data-bs-target="#generate" type="button">
                    <i class="bi bi-file-earmark-arrow-down"></i> 报告生成
                </button>
            </li>
            <li class="nav-item" role="presentation" id="dataTabLi">
                <button class="nav-link" id="data-tab" data-bs-toggle="tab" data-bs-target="#data" type="button">
                    <i class="bi bi-database"></i> 数据管理
                </button>
            </li>
        </ul>

        <!-- 标签页内容 -->
        <div class="tab-content mt-3" id="mainTabContent">
            <!-- 模板管理标签页 -->
            <div class="tab-pane fade show active" id="template" role="tabpanel">
                <div class="alert alert-info">
                    <i class="bi bi-info-circle"></i> <strong>系统流程：</strong>
                    1. 在检测指标管理中完成具体检测指标的编制 →
                    2. 在样品类型管理中将各检测指标选中并汇总 →
                    3. 在报告模板管理中录入Excel模板，最终形成报告模板
                </div>

                <!-- 管理入口卡片 -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="card shadow-sm h-100 border-success">
                            <div class="card-body text-center p-5">
                                <div class="mb-3">
                                    <i class="bi bi-list-check" style="font-size: 3rem; color: #11998e;"></i>
                                </div>
                                <div class="badge bg-success mb-3">步骤 1</div>
                                <h4 class="card-title mb-3">检测指标管理</h4>
                                <p class="card-text text-muted">
                                    编制具体检测指标、限值、检测方法和分组<br>
                                    支持分组筛选、搜索和批量操作
                                </p>
                                <button class="btn btn-success btn-lg mt-3" onclick="window.location.href='/indicators-manager'">
                                    <i class="bi bi-arrow-right-circle"></i> 进入管理
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card shadow-sm h-100 border-primary">
                            <div class="card-body text-center p-5">
                                <div class="mb-3">
                                    <i class="bi bi-tags" style="font-size: 3rem; color: #667eea;"></i>
                                </div>
                                <div class="badge bg-primary mb-3">步骤 2</div>
                                <h4 class="card-title mb-3">样品类型管理</h4>
                                <p class="card-text text-muted">
                                    管理样品类型，选中检测指标并汇总<br>
                                    支持搜索、分页和批量导入导出
                                </p>
                                <button class="btn btn-primary btn-lg mt-3" onclick="window.location.href='/sample-types-manager'">
                                    <i class="bi bi-arrow-right-circle"></i> 进入管理
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 报告模版管理入口 -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <div class="card shadow-sm border-warning">
                            <div class="card-body text-center p-4">
                                <div class="row align-items-center">
                                    <div class="col-md-2">
                                        <i class="bi bi-file-earmark-spreadsheet" style="font-size: 3rem; color: #f39c12;"></i>
                                    </div>
                                    <div class="col-md-7 text-start">
                                        <div class="badge bg-warning text-dark mb-2">步骤 3</div>
                                        <h4 class="card-title mb-2">报告模版管理</h4>
                                        <p class="card-text text-muted mb-0">
                                            导入Excel模板，配置字段映射，最终形成完整的报告模板
                                        </p>
                                    </div>
                                    <div class="col-md-3">
                                        <button class="btn btn-warning btn-lg" onclick="window.location.href='/report-template-manager'">
                                            <i class="bi bi-arrow-right-circle"></i> 进入管理
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- 报告填写标签页 -->
            <div class="tab-pane fade" id="report" role="tabpanel">
                <!-- 子标签导航 -->
                <ul class="nav nav-tabs mb-3" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="new-report-tab" data-bs-toggle="tab" data-bs-target="#new-report" type="button" role="tab">
                            <i class="bi bi-file-earmark-plus"></i> 新建检测报告
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="pending-reports-tab" data-bs-toggle="tab" data-bs-target="#pending-reports" type="button" role="tab">
                            <i class="bi bi-clock-history"></i> 待提交报告
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="submitted-reports-tab" data-bs-toggle="tab" data-bs-target="#submitted-reports" type="button" role="tab">
                            <i class="bi bi-check2-circle"></i> 已提交报告
                        </button>
                    </li>
                    <li class="nav-item" role="presentation" id="edit-report-tab-li" style="display: none;">
                        <button class="nav-link" id="edit-report-tab" data-bs-toggle="tab" data-bs-target="#edit-report" type="button" role="tab">
                            <i class="bi bi-pencil-square"></i> 编辑报告
                        </button>
                    </li>
                </ul>

                <!-- 子标签内容 -->
                <div class="tab-content">
                    <!-- 新建检测报告 -->
                    <div class="tab-pane fade show active" id="new-report" role="tabpanel">
                        <div class="card">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0"><i class="bi bi-file-earmark-plus"></i> 创建检测报告</h5>
                            </div>
                            <div class="card-body">
                                <!-- 基本信息 -->
                                <div class="card mb-3">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0"><i class="bi bi-info-circle"></i> 基本信息</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-3 mb-3">
                                            <div class="col-md-6">
                                                <label class="form-label">报告编号 <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="newReportNumber" placeholder="请输入报告编号">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">样品编号 <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="newReportSampleNumber" placeholder="请输入样品编号">
                                            </div>
                                        </div>
                                        <div class="row g-3 mb-3">
                                            <div class="col-md-6">
                                                <label class="form-label">报告编制日期</label>
                                                <input type="date" class="form-control" id="newReportDate">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">样品类型 <span class="text-danger">*</span></label>
                                                <select class="form-select" id="newReportSampleType">
                                                    <option value="">请选择样品类型...</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row g-3 mb-3">
                                            <div class="col-md-6">
                                                <label class="form-label">样品来源</label>
                                                <div class="position-relative">
                                                    <input type="text" class="form-control" id="newSampleSource" placeholder="请选择或输入样品来源" autocomplete="off">
                                                    <div id="sampleSourceDropdown" class="dropdown-menu w-100">
                                                        <a class="dropdown-item" href="javascript:void(0)" onclick="selectSampleSource('委托采样')">委托采样</a>
                                                        <a class="dropdown-item" href="javascript:void(0)" onclick="selectSampleSource('委托送样')">委托送样</a>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">样品状态</label>
                                                <input type="text" class="form-control" id="newSampleStatus" value="样品完好，液态">
                                            </div>
                                        </div>
                                        <div class="row g-3 mb-3">
                                            <div class="col-md-6">
                                                <label class="form-label">采样人</label>
                                                <input type="text" class="form-control" id="newSampler" placeholder="采样人姓名">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">采样日期</label>
                                                <input type="date" class="form-control" id="newSamplingDate">
                                            </div>
                                        </div>
                                        <div class="row g-3 mb-3">
                                            <div class="col-md-6">
                                                <label class="form-label">收样日期</label>
                                                <input type="date" class="form-control" id="newSampleReceivedDate">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">检测日期</label>
                                                <input type="text" class="form-control" id="newDetectionDate" placeholder="例如: 2024年1月1日">
                                            </div>
                                        </div>
                                        <div class="row g-3 mb-3">
                                            <div class="col-md-6">
                                                <label class="form-label">采样地点</label>
                                                <input type="text" class="form-control" id="newSamplingLocation" placeholder="采样具体地点">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">采样依据</label>
                                                <input type="text" class="form-control" id="newSamplingBasis" value="GB/T 5750.2-2023">
                                            </div>
                                        </div>
                                        <div class="row g-3 mb-3">
                                            <div class="col-md-12">
                                                <label class="form-label">产品标准</label>
                                                <input type="text" class="form-control" id="newProductStandard" value="《生活饮用水卫生标准》 GB5749-2022">
                                            </div>
                                        </div>
                                        <div class="row g-3 mb-3">
                                            <div class="col-md-12">
                                                <label class="form-label">检测项目</label>
                                                <textarea class="form-control" id="newTestItems" rows="3" readonly>色度、浑浊度、pH、菌落总数、氟化物、硫酸盐、铜、铁、锰、砷、锌、铝、氰化物、溶解性总固体、三氯甲烷等共计43项指标</textarea>
                                            </div>
                                        </div>
                                        <div class="row g-3 mb-3">
                                            <div class="col-md-12">
                                                <label class="form-label">检测结论</label>
                                                <textarea class="form-control" id="newTestConclusion" rows="2">该水样所检43项指标除铝外，其余检测项目均符合《生活饮用水卫生标准》GB5749-2022的标准限值要求</textarea>
                                            </div>
                                        </div>
                                        <div class="row g-3 mb-3">
                                            <div class="col-md-12">
                                                <label class="form-label">附加信息</label>
                                                <textarea class="form-control" id="newAdditionalInfo" rows="2" placeholder="其他需要说明的信息"></textarea>
                                            </div>
                                        </div>
                                        <div class="row g-3">
                                            <div class="col-md-12">
                                                <button class="btn btn-primary" id="loadIndicatorsBtn" disabled>
                                                    <i class="bi bi-arrow-down-circle"></i> 加载检测项目
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 客户信息 -->
                                <div class="card mb-3">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0"><i class="bi bi-people"></i> 客户信息（可选）</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-3 mb-3">
                                            <div class="col-md-4">
                                                <label class="form-label">被检单位</label>
                                                <div class="position-relative">
                                                    <input type="text" class="form-control" id="customerUnitInput"
                                                           placeholder="输入或选择被检单位..." autocomplete="off">
                                                    <div id="customerUnitDropdown" class="dropdown-menu w-100" style="max-height: 200px; overflow-y: auto;">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">被检水厂</label>
                                                <select class="form-select" id="customerPlantSelect" disabled>
                                                    <option value="">请先选择被检单位...</option>
                                                </select>
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">&nbsp;</label>
                                                <button class="btn btn-info w-100" id="loadCustomerInfoBtn" disabled>
                                                    <i class="bi bi-arrow-down-circle"></i> 加载客户信息
                                                </button>
                                            </div>
                                        </div>
                                        <div id="customerInfoFields" style="display: none;">
                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <label class="form-label">被检单位地址</label>
                                                    <input type="text" class="form-control" id="customerAddress" placeholder="可手动编辑">
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="form-label">联系人</label>
                                                    <input type="text" class="form-control" id="customerContact" placeholder="可手动编辑">
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="form-label">联系电话</label>
                                                    <input type="text" class="form-control" id="customerPhone" placeholder="可手动编辑">
                                                </div>
                                            </div>
                                            <div class="row g-3 mt-2">
                                                <div class="col-md-12">
                                                    <label class="form-label">邮箱地址</label>
                                                    <input type="text" class="form-control" id="customerEmail" placeholder="可手动编辑">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 检测项目列表 -->
                                <div class="card" id="indicatorsCard" style="display: none;">
                                    <div class="card-header bg-light d-flex justify-content-between align-items-center">
                                        <h6 class="mb-0"><i class="bi bi-clipboard-data"></i> 检测项目及结果</h6>
                                        <small class="text-muted">按样品类型预设顺序排列，可手动调整</small>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-bordered table-hover">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th width="5%">序号</th>
                                                        <th width="18%">检测项目名称</th>
                                                        <th width="8%">单位</th>
                                                        <th width="12%">检测结果</th>
                                                        <th width="15%">限值</th>
                                                        <th width="27%">检测方法</th>
                                                        <th width="15%">操作</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="indicatorsTableBody">
                                                </tbody>
                                            </table>
                                        </div>

                                        <!-- 操作按钮 -->
                                        <div class="mt-4 d-flex gap-2">
                                            <button type="button" class="btn btn-success" id="saveNewReportBtn">
                                                <i class="bi bi-check-circle"></i> 保存报告
                                            </button>
                                            <button type="button" class="btn btn-outline-secondary" id="resetNewReportBtn">
                                                <i class="bi bi-x-circle"></i> 重置
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 待提交报告 -->
                    <div class="tab-pane fade" id="pending-reports" role="tabpanel">
                        <div class="card">
                            <div class="card-header bg-info text-white">
                                <h5 class="mb-0"><i class="bi bi-clock-history"></i> 待提交报告</h5>
                                <div class="text-white-50 small mt-1">草稿和被拒绝的报告</div>
                            </div>
                            <div class="card-body">
                                <!-- 搜索筛选 -->
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <input type="text" class="form-control" id="pendingSearchSampleNumber" placeholder="搜索样品编号...">
                                    </div>
                                    <div class="col-md-4">
                                        <select class="form-select" id="pendingSearchCompany">
                                            <option value="">全部公司</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <button class="btn btn-primary" id="searchPendingBtn">
                                            <i class="bi bi-search"></i> 搜索
                                        </button>
                                        <button class="btn btn-secondary" id="refreshPendingBtn">
                                            <i class="bi bi-arrow-clockwise"></i> 刷新
                                        </button>
                                    </div>
                                </div>

                                <!-- 报告列表 -->
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead class="table-light">
                                            <tr>
                                                <th>报告编号</th>
                                                <th>样品编号</th>
                                                <th>样品类型</th>
                                                <th>被检单位</th>
                                                <th>被检水厂</th>
                                                <th>检测项目数</th>
                                                <th>状态</th>
                                                <th>创建时间</th>
                                                <th>拒绝原因</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody id="pendingReportsTableBody">
                                            <tr>
                                                <td colspan="10" class="text-center text-muted">暂无待提交报告</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 已提交报告 -->
                    <div class="tab-pane fade" id="submitted-reports" role="tabpanel">
                        <div class="card">
                            <div class="card-header bg-success text-white">
                                <h5 class="mb-0"><i class="bi bi-check2-circle"></i> 已提交报告</h5>
                                <div class="text-white-50 small mt-1">已提交审核的报告（待审核、已审核、已生成）</div>
                            </div>
                            <div class="card-body">
                                <!-- 搜索筛选 -->
                                <div class="row mb-3">
                                    <div class="col-md-3">
                                        <input type="text" class="form-control" id="submittedSearchSampleNumber" placeholder="搜索样品编号...">
                                    </div>
                                    <div class="col-md-2">
                                        <select class="form-select" id="submittedSearchStatus">
                                            <option value="">全部状态</option>
                                            <option value="pending">待审核</option>
                                            <option value="approved">已审核</option>
                                            <option value="rejected">已拒绝</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <select class="form-select" id="submittedSearchCompany">
                                            <option value="">全部公司</option>
                                        </select>
                                    </div>
                                    <div class="col-md-2">
                                        <input type="date" class="form-control" id="submittedSearchDate" placeholder="提交日期">
                                    </div>
                                    <div class="col-md-2">
                                        <button class="btn btn-primary" id="searchSubmittedBtn">
                                            <i class="bi bi-search"></i> 搜索
                                        </button>
                                        <button class="btn btn-secondary" id="refreshSubmittedBtn">
                                            <i class="bi bi-arrow-clockwise"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- 报告列表 -->
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead class="table-light">
                                            <tr>
                                                <th>报告编号</th>
                                                <th>样品编号</th>
                                                <th>样品类型</th>
                                                <th>委托单位</th>
                                                <th>模板</th>
                                                <th>审核状态</th>
                                                <th>生成状态</th>
                                                <th>提交时间</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody id="submittedReportsTableBody">
                                            <tr>
                                                <td colspan="9" class="text-center text-muted">暂无已提交报告</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 编辑报告 -->
                    <div class="tab-pane fade" id="edit-report" role="tabpanel">
                        <div class="card">
                            <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center">
                                <h5 class="mb-0"><i class="bi bi-pencil-square"></i> 编辑检测报告 <span id="editReportId" class="badge bg-secondary"></span></h5>
                                <button class="btn btn-sm btn-outline-dark" onclick="cancelEditReport()">
                                    <i class="bi bi-x-circle"></i> 取消编辑
                                </button>
                            </div>
                            <div class="card-body">
                                <!-- 基本信息 -->
                                <div class="card mb-3">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0"><i class="bi bi-info-circle"></i> 基本信息</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-3 mb-3">
                                            <div class="col-md-6">
                                                <label class="form-label">报告编号</label>
                                                <input type="text" class="form-control" id="editReportNumber" readonly>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">报告编制日期</label>
                                                <input type="date" class="form-control" id="editReportDate">
                                            </div>
                                        </div>
                                        <div class="row g-3 mb-3">
                                            <div class="col-md-6">
                                                <label class="form-label">样品编号 <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="editSampleNumber" placeholder="例如: 2024001">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">样品类型</label>
                                                <input type="text" class="form-control" id="editSampleType" readonly>
                                            </div>
                                        </div>
                                        <div class="row g-3 mb-3">
                                            <div class="col-md-6">
                                                <label class="form-label">样品来源</label>
                                                <div class="position-relative">
                                                    <input type="text" class="form-control" id="editSampleSource" placeholder="请选择或输入样品来源" autocomplete="off">
                                                    <div id="editSampleSourceDropdown" class="dropdown-menu w-100">
                                                        <a class="dropdown-item" href="javascript:void(0)" onclick="selectEditSampleSource('委托采样')">委托采样</a>
                                                        <a class="dropdown-item" href="javascript:void(0)" onclick="selectEditSampleSource('委托送样')">委托送样</a>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">样品状态</label>
                                                <input type="text" class="form-control" id="editSampleStatus">
                                            </div>
                                        </div>
                                        <div class="row g-3 mb-3">
                                            <div class="col-md-6">
                                                <label class="form-label">采样人</label>
                                                <input type="text" class="form-control" id="editSampler">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">采样日期</label>
                                                <input type="date" class="form-control" id="editSamplingDate">
                                            </div>
                                        </div>
                                        <div class="row g-3 mb-3">
                                            <div class="col-md-6">
                                                <label class="form-label">收样日期</label>
                                                <input type="date" class="form-control" id="editSampleReceivedDate">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">检测日期</label>
                                                <input type="text" class="form-control" id="editDetectionDate" placeholder="例如: 2024年1月1日">
                                            </div>
                                        </div>
                                        <div class="row g-3 mb-3">
                                            <div class="col-md-6">
                                                <label class="form-label">采样地点</label>
                                                <input type="text" class="form-control" id="editSamplingLocation">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">采样依据</label>
                                                <input type="text" class="form-control" id="editSamplingBasis">
                                            </div>
                                        </div>
                                        <div class="row g-3 mb-3">
                                            <div class="col-md-12">
                                                <label class="form-label">产品标准</label>
                                                <input type="text" class="form-control" id="editProductStandard">
                                            </div>
                                        </div>
                                        <div class="row g-3 mb-3">
                                            <div class="col-md-12">
                                                <label class="form-label">检测结论</label>
                                                <textarea class="form-control" id="editTestConclusion" rows="2"></textarea>
                                            </div>
                                        </div>
                                        <div class="row g-3 mb-3">
                                            <div class="col-md-12">
                                                <label class="form-label">检测项目</label>
                                                <textarea class="form-control" id="editDetectionItems" rows="2" placeholder="例如：pH、菌落总数等"></textarea>
                                                <small class="form-text text-muted">描述本次检测的项目内容</small>
                                            </div>
                                        </div>
                                        <div class="row g-3">
                                            <div class="col-md-12">
                                                <label class="form-label">附加信息</label>
                                                <textarea class="form-control" id="editAdditionalInfo" rows="2"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 客户信息 -->
                                <div class="card mb-3">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0"><i class="bi bi-people"></i> 客户信息</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label class="form-label">被检单位</label>
                                                <input type="text" class="form-control" id="editCustomerUnit">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">被检水厂</label>
                                                <input type="text" class="form-control" id="editCustomerPlant">
                                            </div>
                                        </div>
                                        <div class="row g-3 mt-2">
                                            <div class="col-md-6">
                                                <label class="form-label">被检单位地址</label>
                                                <input type="text" class="form-control" id="editCustomerAddress">
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label">联系人</label>
                                                <input type="text" class="form-control" id="editCustomerContact">
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label">联系电话</label>
                                                <input type="text" class="form-control" id="editCustomerPhone">
                                            </div>
                                        </div>
                                        <div class="row g-3 mt-2">
                                            <div class="col-md-12">
                                                <label class="form-label">邮箱地址</label>
                                                <input type="text" class="form-control" id="editCustomerEmail">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 检测项目列表 -->
                                <div class="card">
                                    <div class="card-header bg-light d-flex justify-content-between align-items-center">
                                        <h6 class="mb-0"><i class="bi bi-clipboard-data"></i> 检测项目及结果</h6>
                                        <small class="text-muted">所有字段均可编辑</small>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-bordered table-hover">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th width="5%">序号</th>
                                                        <th width="18%">检测项目名称</th>
                                                        <th width="8%">单位</th>
                                                        <th width="12%">检测结果</th>
                                                        <th width="15%">限值</th>
                                                        <th width="27%">检测方法</th>
                                                        <th width="15%">操作</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="editIndicatorsTableBody">
                                                </tbody>
                                            </table>
                                        </div>

                                        <!-- 操作按钮 -->
                                        <div class="mt-4 d-flex gap-2">
                                            <button type="button" class="btn btn-success" id="saveEditReportBtn">
                                                <i class="bi bi-check-circle"></i> 保存修改
                                            </button>
                                            <button type="button" class="btn btn-primary" id="submitEditReportBtn">
                                                <i class="bi bi-send"></i> 保存并提交审核
                                            </button>
                                            <button type="button" class="btn btn-outline-secondary" onclick="cancelEditReport()">
                                                <i class="bi bi-x-circle"></i> 取消
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 报告审核标签页 -->
            <div class="tab-pane fade" id="review" role="tabpanel">
                <div class="card">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0"><i class="bi bi-clipboard-check"></i> 报告审核</h5>
                    </div>
                    <div class="card-body">
                        <!-- 筛选条件 -->
                        <div class="row mb-3">
                            <div class="col-md-3">
                                <input type="text" class="form-control" id="reviewSearchSampleNumber" placeholder="搜索样品编号...">
                            </div>
                            <div class="col-md-3">
                                <select class="form-select" id="reviewSearchStatus">
                                    <option value="">全部状态</option>
                                    <option value="draft">草稿</option>
                                    <option value="pending">待审核</option>
                                    <option value="approved">已审核</option>
                                    <option value="rejected">已拒绝</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <select class="form-select" id="reviewSearchCompany">
                                    <option value="">全部公司</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-primary" id="searchReviewBtn">
                                    <i class="bi bi-search"></i> 搜索
                                </button>
                                <button class="btn btn-secondary" id="refreshReviewBtn">
                                    <i class="bi bi-arrow-clockwise"></i> 刷新
                                </button>
                            </div>
                        </div>

                        <!-- 报告列表 -->
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>报告编号</th>
                                        <th>样品编号</th>
                                        <th>样品类型</th>
                                        <th>委托单位</th>
                                        <th>审核状态</th>
                                        <th>创建时间</th>
                                        <th>检测日期</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="reviewReportsList">
                                    <!-- 动态加载 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 报告生成标签页 -->
            <div class="tab-pane fade" id="generate" role="tabpanel">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="bi bi-file-earmark-arrow-down"></i> 报告生成</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i> 只有已审核通过的报告才能生成最终报告文件
                        </div>

                        <!-- 筛选条件 -->
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <input type="text" class="form-control" id="genSearchSampleNumber" placeholder="搜索样品编号...">
                            </div>
                            <div class="col-md-4">
                                <select class="form-select" id="genSearchCompany">
                                    <option value="">全部公司</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-primary" id="searchGenReportBtn">
                                    <i class="bi bi-search"></i> 搜索
                                </button>
                                <button class="btn btn-secondary" id="refreshGenReportBtn">
                                    <i class="bi bi-arrow-clockwise"></i> 刷新
                                </button>
                            </div>
                        </div>

                        <!-- 已审核报告列表 -->
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>报告编号</th>
                                        <th>样品编号</th>
                                        <th>样品类型</th>
                                        <th>委托单位</th>
                                        <th>审核人</th>
                                        <th>审核时间</th>
                                        <th>生成状态</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="genReportsList">
                                    <!-- 动态加载 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 数据管理标签页 -->
            <div class="tab-pane fade" id="data" role="tabpanel">
                <!-- 原始数据管理入口 -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <div class="card shadow-sm border-primary">
                            <div class="card-body text-center p-4">
                                <div class="row align-items-center">
                                    <div class="col-md-8 text-start">
                                        <div class="d-flex align-items-center">
                                            <i class="bi bi-database-fill-add" style="font-size: 3rem; color: #0d6efd;"></i>
                                            <div class="ms-4">
                                                <h4 class="card-title mb-2">
                                                    <i class="bi bi-star-fill text-warning"></i> 原始数据管理
                                                </h4>
                                                <p class="card-text text-muted mb-0">
                                                    Excel数据自动化入库、样品编号精准查询、定制化指标模板导出<br>
                                                    支持数据录入、查询、筛选、导出全流程管理
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <button class="btn btn-primary btn-lg" onclick="window.location.href='/raw-data-manager'">
                                            <i class="bi bi-arrow-right-circle"></i> 进入管理
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 客户管理入口 -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <div class="card shadow-sm border-info">
                            <div class="card-body text-center p-4">
                                <div class="row align-items-center">
                                    <div class="col-md-8 text-start">
                                        <div class="d-flex align-items-center">
                                            <i class="bi bi-people-fill" style="font-size: 3rem; color: #0dcaf0;"></i>
                                            <div class="ms-4">
                                                <h4 class="card-title mb-2">客户管理</h4>
                                                <p class="card-text text-muted mb-0">
                                                    预先录入客户信息（被检单位、水厂、地址、联系人等）<br>
                                                    在生成检测报告时可快速导入相关信息
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <button class="btn btn-info btn-lg" onclick="window.location.href='/customers-manager'">
                                            <i class="bi bi-arrow-right-circle"></i> 进入管理
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-warning text-white">
                                <h5 class="mb-0"><i class="bi bi-database-gear"></i> 数据备份</h5>
                            </div>
                            <div class="card-body">
                                <button class="btn btn-success mb-3" id="createBackupBtn">
                                    <i class="bi bi-cloud-arrow-down"></i> 创建备份
                                </button>
                                <div class="table-responsive">
                                    <table class="table table-sm">
                                        <thead>
                                            <tr>
                                                <th>备份名称</th>
                                                <th>创建时间</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody id="backupsList"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-info text-white">
                                <h5 class="mb-0"><i class="bi bi-clock-history"></i> 操作日志</h5>
                            </div>
                            <div class="card-body">
                                <button class="btn btn-primary btn-sm mb-3" id="refreshLogsBtn">
                                    <i class="bi bi-arrow-clockwise"></i> 刷新
                                </button>
                                <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                    <table class="table table-sm">
                                        <thead>
                                            <tr>
                                                <th>时间</th>
                                                <th>用户</th>
                                                <th>操作</th>
                                                <th>详情</th>
                                            </tr>
                                        </thead>
                                        <tbody id="logsList"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header bg-secondary text-white">
                                <h5 class="mb-0"><i class="bi bi-people"></i> 用户管理</h5>
                            </div>
                            <div class="card-body">
                                <button class="btn btn-success btn-sm mb-3" id="addUserBtn">
                                    <i class="bi bi-person-plus"></i> 添加用户
                                </button>
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>用户名</th>
                                                <th>角色</th>
                                                <th>创建时间</th>
                                            </tr>
                                        </thead>
                                        <tbody id="usersList"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast通知容器 -->
    <div class="toast-container position-fixed top-0 end-0 p-3" id="toastContainer"></div>

    <!-- 模态框容器 -->
    <div id="modalContainer"></div>

    <!-- 模板选择模态框 -->
    <div class="modal fade" id="templateSelectModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-file-earmark-spreadsheet"></i> 选择报告模板</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">请选择要使用的Excel报告模板 <span class="text-danger">*</span></label>
                        <select class="form-select" id="selectedTemplateId" size="6">
                            <option value="">加载中...</option>
                        </select>
                        <div class="form-text">选择模板后，直接生成Excel报告</div>
                    </div>
                    <div id="templateInfo" class="alert alert-info d-none">
                        <strong>模板信息：</strong>
                        <div id="templateInfoContent"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="confirmGenerateBtn">
                        <i class="bi bi-file-earmark-arrow-down"></i> 确认生成
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/app.js"></script>
</body>
</html>
